# 全局替换

主要使用两个ex命令：

1. g（global，全局）
2. s（sbustitute，替换）

## 基本替换

| 动作                             | 命令               |
| -------------------------------- | ------------------ |
| 将当前行第一个出现的old改为new   | :s/old/new/        |
| 将这一行中每一个old替换为new     | :s/old/new/g       |
| 将50-100行之间每一个old替换为new | :50,100s/old/new/g |
| 同下（1,\$s=%s）                 | :1,$s/old/new/g    |
| 将整个文件每一行old替换为new     | :%s/old/new/g      |

## 确认替换

- 我们常常会在替换发生之后，发现替换结果有误，需要撤销。

1. 通过u，撤销上一次替换。
2. 替换之前通过 :w 写入文件，需要替换时，使用:q!不保存退出。
3. 也可以使用 :e! 读出上一个版本的缓冲区内容。（即撤销到上个版本）



- **除此之外，vim编辑器提供了一种<u>确认替换---c选项（confirm）</u>**

| 动作           | 命令           |
| -------------- | -------------- |
| 在替换之前询问 | :%s/old/new/gc |

此时，如果存在多个替换选项，编辑器会逐个询问

1. y，代表本次替换
2. n，代表本次不替换
3. a，替换符合的所有
4. q，退出（不替换）
5. l，替换本次并退出



- 一个技巧

  使用n（重复上一次搜索）、点号（.）（重复上一次命令）结合进行局部替换。

  | 命令      | 行为             |
  | --------- | ---------------- |
  | /old      | 搜索old          |
  | cwnew+ESC | 替换old为new     |
  | n         | 重复搜索         |
  | .         | 重复命令（替换） |

  注意：

  ​	遇到不需要替换的old，直接按n跳到下一个搜索结果即可。

  ​	cwnew：表示c、w、new，修改、一个单词、单词拼写new

## 上下文相关的替换

解释：找到包含模式的某一行时，对另外一个字符串进行替换。

| 命令                   | 行为                                                         |
| ---------------------- | ------------------------------------------------------------ |
| :g/pattern/s/old/new/g | （第一个g）对文件所有行起作用，在出现pattern的行发生替换，将old替换称为new，将这一行所有old都替换（最后一个g） |

注意：

​	第一个g，表示对所有行都起作用。

​	最后一个g，表示在行中进行全局替换。（没有这个g，只替换匹配行中的第一个）



| 命令               | 行为                                                         |
| ------------------ | ------------------------------------------------------------ |
| :g/string/s//new/g | 包含string的行中，相同的字符串string做替换。(全部string都替换) |
| :%s/string/new/g   | 与上一句作用相同（意义相同）                                 |

